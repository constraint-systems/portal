(this.webpackJsonpviewport=this.webpackJsonpviewport||[]).push([[0],{16:function(e,t,n){},19:function(e,t,n){"use strict";n.r(t);var i,r,s,o=n(3),a=n.n(o),c=n(11),d=n.n(c),l=(n(16),n(5)),u=n(0),m=n(9),p=n(1),w=n.n(p),y=n(4),f=new Float32Array([-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0,-.5,-.5,0]),h=function(e,t){return t?2*Math.tan(t.fov*Math.PI/360)*e/window.innerHeight:1},x=function(){var e=Object(y.a)(w.a.mark((function e(t,n){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(new u.p).load(n,(function(e){var n=e.image,i=h(5,k.camera),r=n.width*i,s=n.height*i;t.mesh.scale.set(r,s,1),t.material.map=e}));case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),v=function(e,t,n){e.mouse.set(t,n),e.clip.set(t/window.innerWidth*2-1,-n/window.innerHeight*2+1,.5),e.clip2.set(e.clip.x,e.clip.y),null!==k.camera&&function(e,t,n,i,r){if(null!==i){t.copy(n),t.unproject(i),t.sub(i.position).normalize();var s=(r-i.position.z)/t.z;e.copy(i.position).add(t.multiplyScalar(s))}}(e.ray,e.tempClip,e.clip,k.camera,0)},g=function(e){return{srcWidth:e.src.max.x-e.src.min.x,srcHeight:e.src.max.y-e.src.min.y,dstWidth:e.dst.max.x-e.dst.min.x,dstHeight:e.dst.max.y-e.dst.min.y}},b=function(e){e.line1.geometry.attributes.position.array[0]=e.src.mesh.position.x,e.line1.geometry.attributes.position.array[1]=e.src.mesh.position.y,e.line1.geometry.attributes.position.array[3]=e.dst.mesh.position.x,e.line1.geometry.attributes.position.array[4]=e.dst.mesh.position.y,e.line1.geometry.attributes.position.needsUpdate=!0},O=function(e,t){var n=new u.c;n.setAttribute("position",new u.b(f,3));var i=new u.g({color:e,linewidth:t});return new u.f(n,i)},j=function(){var e=new u.c;e.setAttribute("position",new u.b(new Float32Array([-1,-1,0,1,1,0]),3));var t=new u.g({color:11184810,linewidth:2});return new u.f(e,t)},Y=function(e,t,n,i){var r=function(e,t){var n=Object(l.a)(t,4),i=n[0],r=n[1],s=n[2],o=n[3],a=Object(l.a)(e,4),c=a[0],d=a[1],m=a[2],p=a[3];return{line1:j(),src:{outline:O(11184810,2),mesh:new u.h,occluder:new u.h,min:new u.r(c-m/2,d-p/2,0),max:new u.r(c+m/2,d+p/2,0)},dst:{outline:O(11184810,4),mesh:new u.h,scene:new u.n,occluder:new u.h,min:new u.r(i-s/2,r-o/2,0),max:new u.r(i+s/2,r+o/2,0)}}}(e,t),s=g(r),o=s.srcWidth,a=s.srcHeight,c=s.dstWidth,d=s.dstHeight,p=h(i.position.z,k.camera),w=r.dst.min.x+c/2,y=r.dst.min.y+d/2,f=r.src.mesh,x=new u.k,v=new u.i({transparent:!0,opacity:0});f.geometry=x,f.material=v,f.userData.kind="src",f.scale.set(o,a,1),f.position.x=r.src.min.x+o/2,f.position.y=r.src.min.y+a/2,k.scene&&k.scene.add(f);var Y=new u.e(new Uint8Array(o/p*(a/p)*3),o/p,a/p,u.l),X=r.dst.mesh,D=new u.k,H=new u.i({map:Y});X.userData.kind="dst",X.geometry=D,X.material=H,X.scale.set(c,d,1),X.position.x=w,X.position.y=y,r.dst.scene.add(X),k.scene2.add(r.line1);var E=r.src.occluder,z=new u.k,B=new u.i({color:16711680});E.geometry=z,E.material=B,E.scale.set(o,a,1),E.position.x=r.src.min.x+o/2,E.position.y=r.src.min.y+a/2,E.position.z=1e-5,E.material.colorWrite=!1,k.scene2.add(E);var M=r.dst.occluder,W=new u.k,L=new u.i({color:16711680});M.geometry=W,M.material=L,M.scale.set(c,d,1),M.position.x=r.dst.min.x+c/2,M.position.y=r.dst.min.y+d/2,M.position.z=1e-5,M.material.colorWrite=!1,k.scene2.add(M);var C=r.src.outline;C.scale.set(o,a,1),C.position.x=r.src.min.x+o/2,C.position.y=r.src.min.y+a/2,r.dst.scene.add(r.src.outline);var F=r.dst.outline;F.material.lineWidth=4,F.material.needsUpdate=!0,F.scale.set(c,d,1),F.position.x=r.dst.min.x+c/2,F.position.y=r.dst.min.y+d/2,r.dst.scene.add(r.dst.outline);var S=n.length>0?Math.max.apply(Math,Object(m.a)(n.map((function(e){return e.src.mesh.renderOrder}))))+1:0,q=n.length>0?Math.min.apply(Math,Object(m.a)(n.map((function(e){return e.dst.outline.renderOrder}))))-1:999;r.src.mesh.renderOrder=S,r.dst.mesh.renderOrder=S+1,r.line1.renderOrder=q,r.src.occluder.renderOrder=q-1,r.dst.occluder.renderOrder=q-2,r.src.outline.renderOrder=q-1,r.dst.outline.renderOrder=q-2,k.portals.push(r),b(r)},X=function(e,t){var n=k.drawBox,i=n.outline,r=n.min,s=n.max,o=n.diff;i.visible=!0,r.copy(e).min(t),s.copy(e).max(t),o.subVectors(s,r),i.position.x=r.x+o.x/2,i.position.y=r.y+o.y/2,i.scale.x=o.x,i.scale.y=o.y},D=new u.k,H=new u.o,E=new u.i({map:H});s=D,r=E,i=new u.h(D,E);var k={canvas:null,camera:null,renderer:null,scene:new u.n,scene2:new u.n,scene3:new u.n,scene4:new u.n,raycaster:new u.m,zoomRay:{clip:new u.r,tempClip:new u.r,ray:new u.r},drawBox:{min:new u.r,max:new u.r,diff:new u.r,outline:O(16777215,2)},intersects:[],image:{mesh:i,material:r,geometry:s,box:new u.a,down:new u.r},cameraDown:new u.r,portals:[],pointer:{mouse:new u.q,clip:new u.r,clip2:new u.q,tempClip:new u.r,ray:new u.r,diffMouse:new u.q,diff:new u.r,active:!1,down:{mouse:new u.q,clip:new u.r,clip2:new u.q,tempClip:new u.r,ray:new u.r}}},z=n(8),B=new u.d("rgb(238, 88, 181)"),M=function(e){var t=k.portals,n=k.raycaster,i=k.camera,r=k.canvas;if(i&&r){var s=t.map((function(e){return e.dst.mesh})).concat(t.map((function(e){return e.src.mesh})));n.setFromCamera(e.clip2,i);var o=function(e){if(1===e.length)return e;if(0===e.length)return[];var t=e.map((function(e){return e.renderOrder})),n=Math.max.apply(Math,Object(m.a)(t));return[e[t.indexOf(n)]]}(k.raycaster.intersectObjects(s).map((function(e){return e.object})));k.intersects=o,o.length>0?r.style.cursor="default":r.style.cursor="crosshair";for(var a=k.intersects.map((function(e){return e.uuid})),c=0;c<t.length;c++){var d=t[c],l=d.src.mesh,u=d.dst.mesh;a.includes(l.uuid)||a.includes(u.uuid)?(d.src.outline.material.color.set(B),d.dst.outline.material.color.set(B),d.line1.material.color.set(B)):(d.src.outline.material.color.setHex(11184810),d.dst.outline.material.color.setHex(11184810),d.line1.material.color.setHex(11184810))}}},W=function(){return Object(o.useEffect)((function(){var e=k.canvas,t=k.pointer,n=k.camera,i=k.cameraDown,r=k.image,s=k.portals;if(e&&n){var o=function(s){if(v(t,s.clientX,s.clientY),function(e){e.down.mouse.copy(e.mouse),e.down.clip.copy(e.clip),e.down.ray.copy(e.ray)}(t),r.down.copy(r.mesh.position),i.copy(n.position),t.active=!0,k.intersects.length>0){var o=k.intersects[0];o.userData.origin=new u.r,o.userData.origin.copy(o.position)}else X(t.down.ray,t.ray);e.setPointerCapture(s.pointerId)},a=function(e){if(v(t,e.clientX,e.clientY),t.active){t.diffMouse.copy(t.mouse).sub(t.down.mouse);var i=h(n.position.z,n),o=t.diffMouse.x*i,a=t.diffMouse.y*i;if(k.drawBox.outline.visible)X(t.down.ray,t.ray);else if(k.intersects.length>0){var c=k.intersects[0];if("dst"===c.userData.kind){var d=s.map((function(e){return e.dst.mesh.uuid})).indexOf(c.uuid),l=s[d];c.position.setX(c.userData.origin.x+o),c.position.setY(c.userData.origin.y-a);var u=c.userData.origin.x+o,m=c.userData.origin.y-a;l.dst.min.setX(u-c.scale.x/2),l.dst.min.setY(m-c.scale.y/2),l.dst.max.setX(u+c.scale.x/2),l.dst.max.setY(m+c.scale.y/2),s[d].dst.occluder.position.setX(u),s[d].dst.occluder.position.setY(m),s[d].dst.outline.position.setX(u),s[d].dst.outline.position.setY(m),b(l)}else if("src"===c.userData.kind){var p=s.map((function(e){return e.src.mesh.uuid})).indexOf(c.uuid),w=s[p],y=c.userData.origin.x+o,f=c.userData.origin.y-a;c.position.setX(y),c.position.setY(f),w.src.min.setX(y-c.scale.x/2),w.src.min.setY(f-c.scale.y/2),w.src.max.setX(y+c.scale.x/2),w.src.max.setY(f+c.scale.y/2),s[p].src.occluder.position.setX(y),s[p].src.occluder.position.setY(f),s[p].src.outline.position.setX(y),s[p].src.outline.position.setY(f),w.src.outline.position.setX(c.userData.origin.x+o),w.src.outline.position.setY(c.userData.origin.y-a),b(w)}}else r.mesh.position.setX(r.down.x+o),r.mesh.position.setY(r.down.y-a)}else M(t)},c=function(i){if(t.active=!1,!0===k.drawBox.outline.visible){var r=k.drawBox.diff.x,s=k.drawBox.diff.y,o=[k.drawBox.min.x+r/2,k.drawBox.min.y+s/2,r,s];k.scene2&&(Y(o,o,k.portals,n),k.drawBox.outline.visible=!1)}e.releasePointerCapture(i.pointerId)},d=function(e){var i=window.innerHeight,o=i/(i+e.deltaY);if(k.intersects.length>0){var a,c=Object(z.a)(k.intersects);try{for(c.s();!(a=c.n()).done;){var d=a.value,l=d.scale.x,m=d.scale.y,p=l*o,w=m*o,y=t.ray.x-d.position.x,f=y/l,x=y/p,v=d.position.x+(x-f)*p,O=t.ray.y-d.position.y,j=O/m,Y=O/w,X=d.position.y+(Y-j)*w;if(d.position.x=v,d.position.y=X,d.scale.multiplyScalar(o),"dst"===d.userData.kind){var D=s.map((function(e){return e.dst.mesh.uuid})).indexOf(d.uuid),H=s[D];s[D].dst.occluder.position.setX(v),s[D].dst.occluder.position.setY(X),s[D].dst.outline.position.setX(v),s[D].dst.outline.position.setY(X),s[D].dst.outline.scale.copy(d.scale),s[D].dst.occluder.scale.copy(d.scale),H.dst.min.setX(v-d.scale.x/2),H.dst.min.setY(X-d.scale.y/2),H.dst.max.setX(v+d.scale.x/2),H.dst.max.setY(X+d.scale.y/2),b(H)}else"src"===d.userData.kind&&function(){var e=s.map((function(e){return e.src.mesh.uuid})).indexOf(d.uuid),t=s[e];d.position.setX(v),d.position.setY(X),s[e].src.occluder.position.setX(v),s[e].src.occluder.position.setY(X),s[e].src.outline.position.setX(v),s[e].src.outline.position.setY(X),t.src.outline.position.setX(v),t.src.outline.position.setY(X),s[e].src.outline.scale.copy(d.scale),s[e].src.occluder.scale.copy(d.scale),t.src.min.setX(v-d.scale.x/2),t.src.min.setY(X-d.scale.y/2),t.src.max.setX(v+d.scale.x/2),t.src.max.setY(X+d.scale.y/2);var i=g(t),r=i.srcWidth,o=i.srcHeight,a=h(n.position.z,k.camera),c=new u.e(new Uint8Array(r/a*(o/a)*3),r/a,o/a,u.l);t.dst.mesh.material.map=c,b(t)}()}}catch(T){c.e(T)}finally{c.f()}}else{var E=r.mesh.scale.x,B=r.mesh.scale.y,M=E*o,W=B*o,L=t.ray.x-r.mesh.position.x,C=L/E,F=L/M,S=r.mesh.position.x+(F-C)*M,q=t.ray.y-r.mesh.position.y,A=q/B,P=q/W,I=r.mesh.position.y+(P-A)*W;r.mesh.position.x=S,r.mesh.position.y=I,r.mesh.scale.multiplyScalar(o)}};return e.addEventListener("pointerdown",o),e.addEventListener("pointermove",a),e.addEventListener("pointerup",c),e.addEventListener("pointercancel",c),e.addEventListener("mousewheel",d,{passive:!1}),function(){e.removeEventListener("pointerdown",o),e.removeEventListener("pointermove",a),e.removeEventListener("pointerup",c),e.removeEventListener("pointercancel",c),e.removeEventListener("mousewheel",d)}}}),[]),null},L=n(2),C=function(){var e=Object(o.useRef)(null),t=Object(o.useState)(!1),n=Object(l.a)(t,2),i=n[0],r=n[1];return Object(o.useEffect)((function(){var t=e.current;if(k.canvas=t,null!==t){var n=new u.j(75,window.innerWidth/window.innerHeight,.1,1e3);k.camera=n;var i=new u.s({canvas:t});i.setSize(window.innerWidth,window.innerHeight),i.autoClear=!1,k.renderer=i,r(!0),k.scene.add(k.image.mesh),x(k.image,"bowiebig.png"),n.position.z=5,k.drawBox.outline.visible=!1,k.drawBox.outline.renderOrder=999,k.scene3.add(k.drawBox.outline);var s=new u.q;!function e(){requestAnimationFrame(e),i.clear(),i.render(k.scene,n);for(var t=h(n.position.z,k.camera),r=0;r<k.portals.length;r++){var o=k.portals[r];s.x=o.src.min.x/t+window.innerWidth/2,s.y=o.src.min.y/t+window.innerHeight/2,i.copyFramebufferToTexture(s,o.dst.mesh.material.map),i.render(o.dst.scene,n)}i.render(k.scene2,n),i.clearDepth(),i.render(k.scene3,n)}()}}),[]),Object(o.useEffect)((function(){var e=k.camera,t=k.renderer;if(e&&t){window.addEventListener("resize",(function(){e.aspect=window.innerWidth/window.innerHeight,e.updateProjectionMatrix(),t.setSize(window.innerWidth,window.innerHeight)}))}}),[]),Object(L.jsxs)(L.Fragment,{children:[Object(L.jsx)("canvas",{ref:e}),i?Object(L.jsx)(L.Fragment,{children:Object(L.jsx)(W,{})}):null]})},F=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,20)).then((function(t){var n=t.getCLS,i=t.getFID,r=t.getFCP,s=t.getLCP,o=t.getTTFB;n(e),i(e),r(e),s(e),o(e)}))};d.a.render(Object(L.jsx)(a.a.StrictMode,{children:Object(L.jsx)(C,{})}),document.getElementById("root")),F()}},[[19,1,2]]]);
//# sourceMappingURL=main.fcf776e1.chunk.js.map