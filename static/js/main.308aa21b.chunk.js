(this.webpackJsonpviewport=this.webpackJsonpviewport||[]).push([[0],{12:function(e){e.exports=JSON.parse('{"lastCommit":"8/13/2021, 9:32:37 AM disconnected portals"}')},17:function(e,t,n){},20:function(e,t,n){"use strict";n.r(t);var i,s,r,o=n(3),a=n.n(o),c=n(11),l=n.n(c),d=(n(17),n(5)),u=n(0),m=n(7),p=n(9),w=n(2),y=n.n(w),f=n(4),h=new Float32Array([-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0,-.5,-.5,0]),v=function(e,t){return t?2*Math.tan(t.fov*Math.PI/360)*e/window.innerHeight:1},x=function(){var e=Object(f.a)(y.a.mark((function e(t,n){return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(new u.p).load(n,(function(e){var n=e.image,i=v(1.5,z.camera),s=n.width*i,r=n.height*i;t.mesh.scale.set(s,r,1),t.material.map=e}));case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),b=function(e,t,n){e.mouse.set(t,n),e.clip.set(t/window.innerWidth*2-1,-n/window.innerHeight*2+1,.5),e.clip2.set(e.clip.x,e.clip.y),null!==z.camera&&function(e,t,n,i,s){if(null!==i){t.copy(n),t.unproject(i),t.sub(i.position).normalize();var r=(s-i.position.z)/t.z;e.copy(i.position).add(t.multiplyScalar(r))}}(e.ray,e.tempClip,e.clip,z.camera,0)},g=function(e){return{srcWidth:e.src.max.x-e.src.min.x,srcHeight:e.src.max.y-e.src.min.y,dstWidth:e.dst.max.x-e.dst.min.x,dstHeight:e.dst.max.y-e.dst.min.y}},j=function(e){e.line1.geometry.attributes.position.array[0]=e.src.mesh.position.x,e.line1.geometry.attributes.position.array[1]=e.src.mesh.position.y,e.line1.geometry.attributes.position.array[3]=e.dst.mesh.position.x,e.line1.geometry.attributes.position.array[4]=e.dst.mesh.position.y,e.line1.geometry.attributes.position.needsUpdate=!0},O=function(e,t){var n=new u.c;n.setAttribute("position",new u.b(h,3));var i=new u.g({color:e,linewidth:t});return new u.f(n,i)},Y=function(){var e=new u.c;e.setAttribute("position",new u.b(new Float32Array([-1,-1,0,1,1,0]),3));var t=new u.g({color:11184810,linewidth:2});return new u.f(e,t)},k=function(e,t,n,i){var s=function(e,t){var n=Object(d.a)(t,4),i=n[0],s=n[1],r=n[2],o=n[3],a=Object(d.a)(e,4),c=a[0],l=a[1],m=a[2],p=a[3];return{line1:Y(),src:{outline:O(11184810,2),mesh:new u.h,occluder:new u.h,min:new u.r(c-m/2,l-p/2,0),max:new u.r(c+m/2,l+p/2,0)},dst:{outline:O(11184810,2),mesh:new u.h,scene:new u.n,occluder:new u.h,min:new u.r(i-r/2,s-o/2,0),max:new u.r(i+r/2,s+o/2,0)}}}(e,t),r=g(s),o=r.srcWidth,a=r.srcHeight,c=r.dstWidth,l=r.dstHeight,m=v(i.position.z,z.camera);s.line1.visible=!1;var w=s.dst.min.x+c/2,y=s.dst.min.y+l/2,f=s.src.mesh,h=new u.k,x=new u.i({transparent:!0,opacity:0});f.geometry=h,f.material=x,f.userData.kind="src",f.scale.set(o,a,1),f.position.x=s.src.min.x+o/2,f.position.y=s.src.min.y+a/2,z.scene&&z.scene.add(f);var b=new u.e(new Uint8Array(o/m*(a/m)*3),o/m,a/m,u.l),k=s.dst.mesh,X=new u.k,D=new u.i({map:b});k.userData.kind="dst",k.geometry=X,k.material=D,k.scale.set(c,l,1),k.position.x=w+0,k.position.y=y+0,s.dst.scene.add(k),z.scene2.add(s.line1);var E=s.src.occluder,L=new u.k,H=new u.i({color:16711680});E.geometry=L,E.material=H,E.scale.set(o,a,1),E.position.x=s.src.min.x+o/2,E.position.y=s.src.min.y+a/2,E.position.z=1e-5,E.material.colorWrite=!1,z.scene2.add(E);var M=s.dst.occluder,B=new u.k,C=new u.i({color:16711680});M.geometry=B,M.material=C,M.scale.set(c,l,1),M.position.x=s.dst.min.x+c/2+0,M.position.y=s.dst.min.y+l/2+0,M.position.z=1e-5,M.material.colorWrite=!1,z.scene2.add(M);var W=s.src.outline;W.scale.set(o,a,1),W.position.x=s.src.min.x+o/2,W.position.y=s.src.min.y+a/2,W.visible=z.outlinesVisible,z.scene3.add(s.src.outline);var F=s.dst.outline;F.material.lineWidth=4,F.material.needsUpdate=!0,F.scale.set(c,l,1),F.position.x=s.dst.min.x+c/2+0,F.position.y=s.dst.min.y+l/2+0,F.visible=z.outlinesVisible,z.scene3.add(s.dst.outline);var S=n.length>0?Math.max.apply(Math,Object(p.a)(n.map((function(e){return e.src.mesh.renderOrder}))))+1:0,V=n.length>0?Math.min.apply(Math,Object(p.a)(n.map((function(e){return e.dst.outline.renderOrder}))))-1:999;s.src.mesh.renderOrder=S,s.dst.mesh.renderOrder=S+1,s.line1.renderOrder=V,s.src.occluder.renderOrder=V-1,s.dst.occluder.renderOrder=V-2,s.src.outline.renderOrder=V-3,s.dst.outline.renderOrder=V-2,z.portals.push(s),j(s)},X=function(e,t){var n=z.drawBox,i=n.outline,s=n.min,r=n.max,o=n.diff;i.visible=!0,s.copy(e).min(t),r.copy(e).max(t),o.subVectors(r,s),i.position.x=s.x+o.x/2,i.position.y=s.y+o.y/2,i.scale.x=o.x,i.scale.y=o.y},D=function(){var e,t=Object(m.a)(z.portals);try{for(t.s();!(e=t.n()).done;){var n=e.value;n.src.outline.visible=z.outlinesVisible,n.dst.outline.visible=z.outlinesVisible}}catch(i){t.e(i)}finally{t.f()}},E=new u.k,L=new u.o,H=new u.i({map:L});r=E,s=H,i=new u.h(E,H);var z={canvas:null,camera:null,renderer:null,scene:new u.n,scene2:new u.n,scene3:new u.n,scene4:new u.n,raycaster:new u.m,outlinesVisible:!0,zoomRay:{clip:new u.r,tempClip:new u.r,ray:new u.r},drawBox:{min:new u.r,max:new u.r,diff:new u.r,outline:O(16777215,2)},intersects:[],image:{mesh:i,material:s,geometry:r,box:new u.a,down:new u.r},cameraDown:new u.r,portals:[],pointer:{mouse:new u.q,clip:new u.r,clip2:new u.q,tempClip:new u.r,ray:new u.r,diffMouse:new u.q,diff:new u.r,active:!1,middle:!1,down:{mouse:new u.q,clip:new u.r,clip2:new u.q,tempClip:new u.r,ray:new u.r}}},M=new u.d("rgb(238, 88, 181)"),B=function(e,t){var n=z.portals,i=z.raycaster,s=z.camera,r=z.canvas;if(s&&r){var o=n.map((function(e){return e.dst.mesh})).concat(n.map((function(e){return e.src.mesh})));i.setFromCamera(e.clip2,s);var a=function(e){if(1===e.length)return e;if(0===e.length)return[];var t=e.map((function(e){return e.scale.x*e.scale.y})),n=Math.min.apply(Math,Object(p.a)(t));return[e[t.indexOf(n)]]}(z.raycaster.intersectObjects(o).map((function(e){return e.object})));z.intersects=a,t.ctrlKey&&(z.intersects=[]),z.intersects.length>0?r.style.cursor="default":r.style.cursor="crosshair";for(var c=z.intersects.map((function(e){return e.uuid})),l=0;l<n.length;l++){var d=n[l],u=d.src.mesh,m=d.dst.mesh;c.includes(u.uuid)||c.includes(m.uuid)?(d.src.outline.material.color.set(65535),d.src.outline.visible=!0,d.dst.outline.material.color.set(16711935),d.dst.outline.visible=!0,d.line1.material.color.set(M)):(d.src.outline.material.color.setHex(11184810),d.src.outline.visible=z.outlinesVisible,d.dst.outline.material.color.setHex(11184810),d.dst.outline.visible=z.outlinesVisible,d.line1.material.color.setHex(11184810))}}},C=function(){return Object(o.useEffect)((function(){var e=z.canvas,t=z.pointer,n=z.camera,i=z.cameraDown,s=z.image,r=z.portals;if(e&&n){var o=function(r){if(b(t,r.clientX,r.clientY),function(e){e.down.mouse.copy(e.mouse),e.down.clip.copy(e.clip),e.down.ray.copy(e.ray)}(t),s.down.copy(s.mesh.position),i.copy(n.position),t.active=!0,t.middle=2===r.which,B(t,r),z.intersects.length>0&&!r.ctrlKey){var o=z.intersects[0];o.userData.origin=new u.r,o.userData.origin.copy(o.position)}else X(t.down.ray,t.ray);e.setPointerCapture(r.pointerId)},a=function(e){if(b(t,e.clientX,e.clientY),t.active){t.diffMouse.copy(t.mouse).sub(t.down.mouse);var i=v(n.position.z,n),o=t.diffMouse.x*i,a=t.diffMouse.y*i;if(t.middle)s.mesh.position.setX(s.down.x+o),s.mesh.position.setY(s.down.y-a);else if(z.drawBox.outline.visible)X(t.down.ray,t.ray);else if(z.intersects.length>0){var c=z.intersects[0];if("dst"===c.userData.kind){var l=r.map((function(e){return e.dst.mesh.uuid})).indexOf(c.uuid),d=r[l];c.position.setX(c.userData.origin.x+o),c.position.setY(c.userData.origin.y-a);var u=c.userData.origin.x+o,m=c.userData.origin.y-a;d.dst.min.setX(u-c.scale.x/2),d.dst.min.setY(m-c.scale.y/2),d.dst.max.setX(u+c.scale.x/2),d.dst.max.setY(m+c.scale.y/2),r[l].dst.occluder.position.setX(u),r[l].dst.occluder.position.setY(m),r[l].dst.outline.position.setX(u),r[l].dst.outline.position.setY(m),j(d)}else if("src"===c.userData.kind){var p=r.map((function(e){return e.src.mesh.uuid})).indexOf(c.uuid),w=r[p],y=c.userData.origin.x+o,f=c.userData.origin.y-a;c.position.setX(y),c.position.setY(f),w.src.min.setX(y-c.scale.x/2),w.src.min.setY(f-c.scale.y/2),w.src.max.setX(y+c.scale.x/2),w.src.max.setY(f+c.scale.y/2),r[p].src.occluder.position.setX(y),r[p].src.occluder.position.setY(f),r[p].src.outline.position.setX(y),r[p].src.outline.position.setY(f),w.src.outline.position.setX(c.userData.origin.x+o),w.src.outline.position.setY(c.userData.origin.y-a),j(w)}}}else B(t,e)},c=function(i){if(t.active=!1,t.middle=!1,!0===z.drawBox.outline.visible){var s=z.drawBox.diff.x,r=z.drawBox.diff.y,o=[z.drawBox.min.x+s/2,z.drawBox.min.y+r/2,s,r];z.scene2&&(k(o,o,z.portals,n),z.drawBox.outline.visible=!1)}e.releasePointerCapture(i.pointerId)},l=function(e){var i=window.innerHeight,o=i/(i+e.deltaY);if(z.intersects.length>0){var a,c=Object(m.a)(z.intersects);try{for(c.s();!(a=c.n()).done;){var l=a.value,d=l.scale.x,p=l.scale.y,w=d*o,y=p*o,f=t.ray.x-l.position.x,h=f/d,x=f/w,b=l.position.x+(x-h)*w,O=t.ray.y-l.position.y,Y=O/p,k=O/y,X=l.position.y+(k-Y)*y;if(l.position.x=b,l.position.y=X,l.scale.multiplyScalar(o),"dst"===l.userData.kind){var D=r.map((function(e){return e.dst.mesh.uuid})).indexOf(l.uuid),E=r[D];r[D].dst.occluder.position.setX(b),r[D].dst.occluder.position.setY(X),r[D].dst.outline.position.setX(b),r[D].dst.outline.position.setY(X),r[D].dst.outline.scale.copy(l.scale),r[D].dst.occluder.scale.copy(l.scale),E.dst.min.setX(b-l.scale.x/2),E.dst.min.setY(X-l.scale.y/2),E.dst.max.setX(b+l.scale.x/2),E.dst.max.setY(X+l.scale.y/2),j(E)}else"src"===l.userData.kind&&function(){var e=r.map((function(e){return e.src.mesh.uuid})).indexOf(l.uuid),t=r[e];l.position.setX(b),l.position.setY(X),r[e].src.occluder.position.setX(b),r[e].src.occluder.position.setY(X),r[e].src.outline.position.setX(b),r[e].src.outline.position.setY(X),t.src.outline.position.setX(b),t.src.outline.position.setY(X),r[e].src.outline.scale.copy(l.scale),r[e].src.occluder.scale.copy(l.scale),t.src.min.setX(b-l.scale.x/2),t.src.min.setY(X-l.scale.y/2),t.src.max.setX(b+l.scale.x/2),t.src.max.setY(X+l.scale.y/2);var i=g(t),s=i.srcWidth,o=i.srcHeight,a=v(n.position.z,z.camera),c=new u.e(new Uint8Array(s/a*(o/a)*3),s/a,o/a,u.l);t.dst.mesh.material.map=c,j(t)}()}}catch(I){c.e(I)}finally{c.f()}}else{var L=s.mesh.scale.x,H=s.mesh.scale.y,M=L*o,B=H*o,C=t.ray.x-s.mesh.position.x,W=C/L,F=C/M,S=s.mesh.position.x+(F-W)*M,V=t.ray.y-s.mesh.position.y,A=V/H,q=V/B,P=s.mesh.position.y+(q-A)*B;s.mesh.position.x=S,s.mesh.position.y=P,s.mesh.scale.multiplyScalar(o)}};return e.addEventListener("pointerdown",o),e.addEventListener("pointermove",a),e.addEventListener("pointerup",c),e.addEventListener("pointercancel",c),e.addEventListener("mousewheel",l,{passive:!1}),function(){e.removeEventListener("pointerdown",o),e.removeEventListener("pointermove",a),e.removeEventListener("pointerup",c),e.removeEventListener("pointercancel",c),e.removeEventListener("mousewheel",l)}}}),[]),null},W=n(12),F=n(1),S=function(){return Object(F.jsxs)("div",{style:{position:"fixed",right:0,bottom:0,background:"white",color:"black",fontSize:13,lineHeight:1.2},children:["Under construction",Object(F.jsx)("br",{}),Object(F.jsx)("a",{href:"https://github.com/constraint-systems/portal",target:"_blank",rel:"noreferrer",children:W.lastCommit})]})};var V=function(){return Object(o.useEffect)((function(){var e=function(e){if(z.camera){var t=v(z.camera.position.z,z.camera);"arrowdown"===e?z.image.mesh.position.y-=32*t:"arrowup"===e?z.image.mesh.position.y+=32*t:"arrowleft"===e?z.image.mesh.position.x-=32*t:"arrowright"===e?z.image.mesh.position.x+=32*t:";"===e?(z.outlinesVisible=!z.outlinesVisible,D()):"control"===e&&z.canvas&&(z.canvas.style.cursor="crosshair")}},t=function(t){var n=t.key.toLowerCase();e(n)},n=function(e){};return window.addEventListener("keydown",t),window.addEventListener("keyup",n),function(){window.removeEventListener("keydown",t),window.removeEventListener("keyup",n)}}),[]),null},A=function(){return Object(F.jsx)("div",{style:{position:"fixed",left:0,bottom:0,background:"white",color:"black",fontSize:13,lineHeight:1.2,paddingLeft:"0.5ch"},children:"; - toggle outlines"})},q=function(){var e=Object(o.useRef)(null),t=Object(o.useState)(!1),n=Object(d.a)(t,2),i=n[0],s=n[1];return Object(o.useEffect)((function(){var t=e.current;if(z.canvas=t,null!==t){var n=new u.j(75,window.innerWidth/window.innerHeight,.1,1e3);z.camera=n;var i=new u.s({canvas:t});i.setSize(window.innerWidth,window.innerHeight),i.autoClear=!1,z.renderer=i,s(!0),z.scene.add(z.image.mesh),x(z.image,"bowiebig.png"),n.position.z=5,z.drawBox.outline.visible=!1,z.drawBox.outline.renderOrder=999,z.scene3.add(z.drawBox.outline);var r=new u.q;D();!function e(){requestAnimationFrame(e),i.clear(),i.render(z.scene,n);for(var t=v(n.position.z,z.camera),s=0;s<z.portals.length;s++){var o=z.portals[s];r.x=o.src.min.x/t+window.innerWidth/2,r.y=o.src.min.y/t+window.innerHeight/2,i.copyFramebufferToTexture(r,o.dst.mesh.material.map),i.render(o.dst.scene,n)}i.render(z.scene2,n),i.clearDepth(),i.render(z.scene3,n)}()}}),[]),Object(o.useEffect)((function(){var e=z.camera,t=z.renderer;if(e&&t){window.addEventListener("resize",(function(){e.aspect=window.innerWidth/window.innerHeight,e.updateProjectionMatrix(),t.setSize(window.innerWidth,window.innerHeight)}))}}),[]),Object(F.jsxs)(F.Fragment,{children:[Object(F.jsx)("canvas",{ref:e}),i?Object(F.jsxs)(F.Fragment,{children:[Object(F.jsx)(C,{}),Object(F.jsx)(V,{}),Object(F.jsx)(A,{})]}):null,Object(F.jsx)(S,{})]})},P=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,21)).then((function(t){var n=t.getCLS,i=t.getFID,s=t.getFCP,r=t.getLCP,o=t.getTTFB;n(e),i(e),s(e),r(e),o(e)}))};l.a.render(Object(F.jsx)(a.a.StrictMode,{children:Object(F.jsx)(q,{})}),document.getElementById("root")),P()}},[[20,1,2]]]);
//# sourceMappingURL=main.308aa21b.chunk.js.map