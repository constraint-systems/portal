(this.webpackJsonpviewport=this.webpackJsonpviewport||[]).push([[0],{23:function(e){e.exports=JSON.parse('{"lastCommit":"8/13/2021, 10:38:51 PM ctrl to always draw"}')},28:function(e,t,i){},31:function(e,t,i){"use strict";i.r(t);var n,s,r,o=i(11),a=i.n(o),c=i(22),l=i.n(c),d=(i(28),i(14)),u=i(6),m=i(15),p=i(18),w=i(10),f=i.n(w),h=i(13),v=i(21),y=function(e,t){return t?2*Math.tan(t.fov*Math.PI/360)*e/window.innerHeight:1},x=function(e){var t=16*y(5,M.camera);return Math.round(e/t)*t},b=function(e){var t=8*y(5,M.camera);return Math.round(e/t)*t},g=function(){var e=Object(h.a)(f.a.mark((function e(t,i){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(new u.q).load(i,(function(e){var i=e.image,n=y(1.5,M.camera),s=x(i.width*n),r=x(i.height*n);t.mesh.scale.set(s,r,1),t.material.map=e}));case 2:case"end":return e.stop()}}),e)})));return function(t,i){return e.apply(this,arguments)}}(),O=function(e,t,i){e.mouse.set(t,i),e.clip.set(t/window.innerWidth*2-1,-i/window.innerHeight*2+1,.5),e.clip2.set(e.clip.x,e.clip.y),null!==M.camera&&function(e,t,i,n,s){if(null!==n){t.copy(i),t.unproject(n),t.sub(n.position).normalize();var r=(s-n.position.z)/t.z;e.copy(n.position).add(t.multiplyScalar(r)),e.x=b(e.x),e.y=b(e.y)}}(e.ray,e.tempClip,e.clip,M.camera,0)},j=function(e){return{srcWidth:e.src.max.x-e.src.min.x,srcHeight:e.src.max.y-e.src.min.y,dstWidth:e.dst.max.x-e.dst.min.x,dstHeight:e.dst.max.y-e.dst.min.y}},k=function(e){e.line1.geometry.attributes.position.array[0]=e.src.mesh.position.x,e.line1.geometry.attributes.position.array[1]=e.src.mesh.position.y,e.line1.geometry.attributes.position.array[3]=e.dst.mesh.position.x,e.line1.geometry.attributes.position.array[4]=e.dst.mesh.position.y,e.line1.geometry.attributes.position.needsUpdate=!0},Y=function(e,t){var i=new u.r(window.innerWidth,window.innerHeight),n=new v.b({color:e,lineWidth:t,sizeAttenuation:0,resolution:i}),s=new v.a;return s.setPoints([-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0,-.5,-.5,0]),new u.h(s,n)},X=function(){var e=new u.c;e.setAttribute("position",new u.b(new Float32Array([-1,-1,0,1,1,0]),3));var t=new u.g({color:11184810,linewidth:8});return new u.f(e,t)},E=function(e,t,i,n){var s=function(e,t){var i=Object(d.a)(t,4),n=i[0],s=i[1],r=i[2],o=i[3],a=Object(d.a)(e,4),c=a[0],l=a[1],m=a[2],p=a[3];return{line1:X(),src:{outline:Y("#aaaaaa",8),mesh:new u.h,occluder:new u.h,min:new u.s(c-m/2,l-p/2,0),max:new u.s(c+m/2,l+p/2,0),scale:new u.s(m,p,1)},dst:{outline:Y("#aaaaaa",8),mesh:new u.h,scene:new u.o,occluder:new u.h,min:new u.s(n-r/2,s-o/2,0),max:new u.s(n+r/2,s+o/2,0),scale:new u.s(r,o,1)}}}(e,t),r=j(s),o=r.srcWidth,a=r.srcHeight,c=r.dstWidth,l=r.dstHeight,m=y(n.position.z,M.camera);s.line1.visible=!1;var w=s.dst.min.x+c/2,f=s.dst.min.y+l/2,h=s.src.mesh,v=new u.k,x=new u.i({transparent:!0,opacity:0});h.geometry=v,h.material=x,h.userData.kind="src",h.scale.set(o,a,1),h.position.x=s.src.min.x+o/2,h.position.y=s.src.min.y+a/2,M.scene&&M.scene.add(h);var b=new u.e(new Uint8Array(o/m*(a/m)*3),o/m,a/m,u.l),g=s.dst.mesh,O=new u.k,E=new u.i({map:b,alphaTest:.5});g.userData.kind="dst",g.geometry=O,g.material=E,g.scale.set(c,l,1),g.position.x=w+0,g.position.y=f+0,s.dst.scene.add(g),M.scene2.add(s.line1);var H=s.src.occluder,L=new u.k,z=new u.i({color:16711680});H.geometry=L,H.material=z,H.scale.set(o,a,1),H.position.x=s.src.min.x+o/2,H.position.y=s.src.min.y+a/2,H.position.z=1e-5,H.material.colorWrite=!1,M.scene2.add(H);var D=s.dst.occluder,W=new u.k,C=new u.i({color:16711680});D.geometry=W,D.material=C,D.scale.set(c,l,1),D.position.x=s.dst.min.x+c/2+0,D.position.y=s.dst.min.y+l/2+0,D.position.z=1e-5,D.material.colorWrite=!1,M.scene2.add(D);var B=s.src.outline;B.scale.set(o,a,1),console.log(B.scale),B.position.x=s.src.min.x+o/2,B.position.y=s.src.min.y+a/2,B.visible=M.outlinesVisible,M.scene3.add(s.src.outline);var V=s.dst.outline;V.scale.set(c,l,1),V.position.x=s.dst.min.x+c/2+0,V.position.y=s.dst.min.y+l/2+0,V.visible=M.outlinesVisible,M.scene3.add(s.dst.outline);var F=i.length>0?Math.max.apply(Math,Object(p.a)(i.map((function(e){return e.src.mesh.renderOrder}))))+1:0,S=i.length>0?Math.min.apply(Math,Object(p.a)(i.map((function(e){return e.dst.outline.renderOrder}))))-1:999;s.src.mesh.renderOrder=F,s.dst.mesh.renderOrder=F+1,s.line1.renderOrder=S,s.src.occluder.renderOrder=S-1,s.dst.occluder.renderOrder=S-2,s.src.outline.renderOrder=S-3,s.dst.outline.renderOrder=S-2,M.portals.push(s),k(s)},H=function(e,t){var i=M.drawBox,n=i.outline,s=i.min,r=i.max,o=i.diff;n.visible=!0,s.copy(e).min(t),r.copy(e).max(t),o.subVectors(r,s),n.position.x=s.x+o.x/2,n.position.y=s.y+o.y/2,n.scale.x=o.x,n.scale.y=o.y},L=function(){var e,t=Object(m.a)(M.portals);try{for(t.s();!(e=t.n()).done;){var i=e.value;i.src.outline.visible=M.outlinesVisible,i.dst.outline.visible=M.outlinesVisible}}catch(n){t.e(n)}finally{t.f()}},z=new u.k,D=new u.p,W=new u.i({map:D});r=z,s=W,n=new u.h(z,W);var M={canvas:null,camera:null,renderer:null,scene:new u.o,scene2:new u.o,scene3:new u.o,scene4:new u.o,raycaster:new u.n,outlinesVisible:!0,zoomRay:{clip:new u.s,tempClip:new u.s,ray:new u.s},drawBox:{min:new u.s,max:new u.s,diff:new u.s,outline:Y("#ff00ff",12)},intersects:[],selected:[],image:{mesh:n,material:s,geometry:r,box:new u.a,down:new u.s},cameraDown:new u.s,portals:[],pointer:{mouse:new u.r,clip:new u.s,clip2:new u.r,tempClip:new u.s,ray:new u.s,diffMouse:new u.r,diff:new u.s,active:!1,middle:!1,down:{mouse:new u.r,clip:new u.s,clip2:new u.r,tempClip:new u.s,ray:new u.s}},pressed:[]},C=new u.d("rgb(238, 88, 181)"),B=function(e,t){var i=M.portals,n=M.raycaster,s=M.camera,r=M.canvas;if(s&&r){var o=i.map((function(e){return e.dst.mesh})).concat(i.map((function(e){return e.src.mesh})));n.setFromCamera(e.clip2,s);var a=function(e){if(1===e.length)return e;if(0===e.length)return[];var t=e.map((function(e){return e.scale.x*e.scale.y})),i=Math.min.apply(Math,Object(p.a)(t));return[e[t.indexOf(i)]]}(M.raycaster.intersectObjects(o).map((function(e){return e.object})));M.intersects=a,M.pressed.includes("c")&&(M.intersects=[]),M.intersects.length>0?r.style.cursor="default":r.style.cursor="crosshair";for(var c=M.intersects.map((function(e){return e.uuid})),l=M.selected.map((function(e){return e.uuid})),d=0;d<i.length;d++){var u=i[d],m=u.src.mesh,w=u.dst.mesh;c.includes(m.uuid)||c.includes(w.uuid)?(u.src.outline.material.color.set(65535),u.src.outline.visible=!0,u.dst.outline.material.color.set(16711935),u.dst.outline.visible=!0,u.line1.material.color.set(C)):l.includes(m.uuid)||l.includes(w.uuid)||(u.src.outline.material.color.setHex(11184810),u.src.outline.visible=M.outlinesVisible,u.dst.outline.material.color.setHex(11184810),u.dst.outline.visible=M.outlinesVisible,u.line1.material.color.setHex(11184810))}}},V=function(){return Object(o.useEffect)((function(){var e=M.canvas,t=M.pointer,i=M.camera,n=M.cameraDown,s=M.image,r=M.portals;if(e&&i){var o=function(r){if(O(t,r.clientX,r.clientY),function(e){e.down.mouse.copy(e.mouse),e.down.clip.copy(e.clip),e.down.ray.copy(e.ray)}(t),s.down.copy(s.mesh.position),n.copy(i.position),t.active=!0,t.middle=2===r.which,B(t),M.intersects.length>0&&!r.ctrlKey){!function(e){var t=M.portals;if(M.selected=e,M.selected.length>0)for(var i=M.selected.map((function(e){return e.uuid})),n=0;n<t.length;n++){var s=t[n],r=s.src.mesh,o=s.dst.mesh;i.includes(r.uuid)||i.includes(o.uuid)?(s.src.outline.material.color.set(65535),s.src.outline.material.lineWidth=12,s.src.outline.visible=!0,s.dst.outline.material.color.set(16711935),s.dst.outline.material.lineWidth=12,s.dst.outline.visible=!0):(s.src.outline.material.color.setHex(11184810),s.src.outline.visible=M.outlinesVisible,s.src.outline.material.lineWidth=8,s.dst.outline.material.color.setHex(11184810),s.dst.outline.visible=M.outlinesVisible,s.dst.outline.material.lineWidth=8,s.line1.material.color.setHex(11184810))}}(M.intersects);var o=M.intersects[0];o.userData.origin=new u.s,o.userData.origin.copy(o.position)}else H(t.down.ray,t.ray);e.setPointerCapture(r.pointerId)},a=function(e){if(O(t,e.clientX,e.clientY),t.active){t.diffMouse.copy(t.mouse).sub(t.down.mouse);var n=y(i.position.z,i),o=t.diffMouse.x*n,a=t.diffMouse.y*n;if(t.middle)s.mesh.position.setX(b(s.down.x+o)),s.mesh.position.setY(b(s.down.y-a));else if(M.drawBox.outline.visible)H(t.down.ray,t.ray);else if(M.selected.length>0){var c=M.selected[0];if("dst"===c.userData.kind){var l=r.map((function(e){return e.dst.mesh.uuid})).indexOf(c.uuid),d=r[l],u=b(c.userData.origin.x-c.scale.x/2+o)+c.scale.x/2,m=b(c.userData.origin.y-c.scale.y/2-a)+c.scale.y/2;c.position.setX(u),c.position.setY(m),d.dst.min.setX(u-c.scale.x/2),d.dst.min.setY(m-c.scale.y/2),d.dst.max.setX(u+c.scale.x/2),d.dst.max.setY(m+c.scale.y/2),r[l].dst.occluder.position.setX(u),r[l].dst.occluder.position.setY(m),r[l].dst.outline.position.setX(u),r[l].dst.outline.position.setY(m),k(d)}else if("src"===c.userData.kind){var p=r.map((function(e){return e.src.mesh.uuid})).indexOf(c.uuid),w=r[p],f=b(c.userData.origin.x-c.scale.x/2+o)+c.scale.x/2,h=b(c.userData.origin.y-c.scale.y/2-a)+c.scale.y/2;c.position.setX(f),c.position.setY(h),w.src.min.setX(f-c.scale.x/2),w.src.min.setY(h-c.scale.y/2),w.src.max.setX(f+c.scale.x/2),w.src.max.setY(h+c.scale.y/2),r[p].src.occluder.position.setX(f),r[p].src.occluder.position.setY(h),r[p].src.outline.position.setX(f),r[p].src.outline.position.setY(h),w.src.outline.position.setX(f),w.src.outline.position.setY(h),k(w)}}}else B(t)},c=function(n){if(t.active=!1,t.middle=!1,!0===M.drawBox.outline.visible){var s=M.drawBox.diff.x,r=M.drawBox.diff.y,o=[M.drawBox.min.x+s/2,M.drawBox.min.y+r/2,s,r];M.scene2&&(E(o,o,M.portals,i),M.drawBox.outline.visible=!1)}e.releasePointerCapture(n.pointerId)},l=function(e){var t=y(i.position.z,M.camera),n=e.deltaY>0?-1:1;if(M.selected.length>0){var s,o=M.selected.map((function(e){return e.uuid})),a=Object(m.a)(M.intersects);try{for(a.s();!(s=a.n()).done;){var c=s.value;if(o.includes(c.uuid)){var l=void 0,d=void 0;if("dst"===c.userData.kind){var p=r.map((function(e){return e.dst.mesh.uuid})).indexOf(c.uuid);l=r[p],d="dst"}else if("src"===c.userData.kind){var w=r.map((function(e){return e.src.mesh.uuid})).indexOf(c.uuid);l=r[w],d="src"}if(l&&d){var f=l[d].scale.x/l[d].scale.y;f>1?(l[d].scale.x+=16*t*n,l[d].scale.y=l[d].scale.x/f):(l[d].scale.y+=16*t*n,l[d].scale.x=l[d].scale.y*f);var h=b(l[d].scale.x),v=b(l[d].scale.y),x=c.position.x,g=c.position.y;if(c.position.x=x,c.position.y=g,c.scale.x=h,c.scale.y=v,"dst"===c.userData.kind){var O=r.map((function(e){return e.dst.mesh.uuid})).indexOf(c.uuid);r[O].dst.occluder.position.setX(x),r[O].dst.occluder.position.setY(g),r[O].dst.outline.position.setX(x),r[O].dst.outline.position.setY(g),r[O].dst.outline.scale.copy(c.scale),r[O].dst.occluder.scale.copy(c.scale),l.dst.min.setX(x-c.scale.x/2),l.dst.min.setY(g-c.scale.y/2),l.dst.max.setX(x+c.scale.x/2),l.dst.max.setY(g+c.scale.y/2),k(l)}else"src"===c.userData.kind&&function(){var e=r.map((function(e){return e.src.mesh.uuid})).indexOf(c.uuid);c.position.setX(x),c.position.setY(g),r[e].src.occluder.position.setX(x),r[e].src.occluder.position.setY(g),r[e].src.outline.position.setX(x),r[e].src.outline.position.setY(g),l.src.outline.position.setX(x),l.src.outline.position.setY(g),r[e].src.outline.scale.copy(c.scale),r[e].src.occluder.scale.copy(c.scale),l.src.min.setX(x-c.scale.x/2),l.src.min.setY(g-c.scale.y/2),l.src.max.setX(x+c.scale.x/2),l.src.max.setY(g+c.scale.y/2);var t=j(l),n=t.srcWidth,s=t.srcHeight,o=y(i.position.z,M.camera),a=new u.e(new Uint8Array(n/o*(s/o)*3),n/o,s/o,u.m);l.dst.mesh.material.map=a,k(l)}()}}}}catch(Y){a.e(Y)}finally{a.f()}}};return e.addEventListener("pointerdown",o),e.addEventListener("pointermove",a),e.addEventListener("pointerup",c),e.addEventListener("pointercancel",c),e.addEventListener("mousewheel",l,{passive:!1}),function(){e.removeEventListener("pointerdown",o),e.removeEventListener("pointermove",a),e.removeEventListener("pointerup",c),e.removeEventListener("pointercancel",c),e.removeEventListener("mousewheel",l)}}}),[]),null},F=i(23),S=i(9),P=function(){return Object(S.jsxs)("div",{style:{position:"fixed",right:0,bottom:0,background:"white",color:"black",fontSize:13,lineHeight:1.2},children:["Under construction",Object(S.jsx)("br",{}),Object(S.jsx)("a",{href:"https://github.com/constraint-systems/portal",target:"_blank",rel:"noreferrer",children:F.lastCommit})]})};var A=function(){return Object(o.useEffect)((function(){var e=function(e){if(M.camera){var t=y(M.camera.position.z,M.camera);"arrowdown"===e?M.image.mesh.position.y-=32*t:"arrowup"===e?M.image.mesh.position.y+=32*t:"arrowleft"===e?M.image.mesh.position.x-=32*t:"arrowright"===e?M.image.mesh.position.x+=32*t:"v"===e?(M.outlinesVisible=!M.outlinesVisible,L()):"c"===e&&M.canvas&&(M.canvas.style.cursor="crosshair")}},t=function(t){var i=t.key.toLowerCase();t.repeat||M.pressed.push(i),e(i)},i=function(e){var t=e.key.toLowerCase(),i=M.pressed.indexOf(t);-1!==i&&(M.pressed.splice(i,1),console.log(M.pressed))};return window.addEventListener("keydown",t),window.addEventListener("keyup",i),function(){window.removeEventListener("keydown",t),window.removeEventListener("keyup",i)}}),[]),null},I=function(){return Object(S.jsxs)("div",{style:{position:"fixed",left:0,bottom:0,background:"white",color:"black",fontSize:13,lineHeight:1.2,paddingLeft:"0.5ch"},children:["v - toggle outlines",Object(S.jsx)("br",{}),"hold c - make new instead of select"]})},T=function(){var e=Object(o.useRef)(null),t=Object(o.useState)(!1),i=Object(d.a)(t,2),n=i[0],s=i[1];return Object(o.useEffect)((function(){var e=document.createElement("canvas");e.width=8,e.height=8;var t=e.getContext("2d");if(t){t.fillStyle="#222",t.fillRect(3,3,2,2);var i=e.toDataURL();document.body.style.backgroundImage='url("'.concat(i,'")')}}),[]),Object(o.useEffect)((function(){var t=e.current;if(M.canvas=t,null!==t){var i=new u.j(75,window.innerWidth/window.innerHeight,.1,1e3);M.camera=i;var n=new u.t({canvas:t,alpha:!0});n.setSize(window.innerWidth,window.innerHeight),n.autoClear=!1,M.renderer=n,s(!0),M.scene.add(M.image.mesh),g(M.image,"bowiebig.png"),i.position.z=5,M.drawBox.outline.visible=!1,M.drawBox.outline.renderOrder=999,M.scene3.add(M.drawBox.outline);var r=new u.r;L();!function e(){requestAnimationFrame(e),n.clear(),n.render(M.scene,i);for(var t=y(i.position.z,M.camera),s=0;s<M.portals.length;s++){var o=M.portals[s];r.x=o.src.min.x/t+window.innerWidth/2,r.y=o.src.min.y/t+window.innerHeight/2,n.copyFramebufferToTexture(r,o.dst.mesh.material.map),n.render(o.dst.scene,i)}n.render(M.scene2,i),n.clearDepth(),n.render(M.scene3,i),n.render(M.scene4,i)}()}}),[]),Object(o.useEffect)((function(){var e=M.camera,t=M.renderer;if(e&&t){window.addEventListener("resize",(function(){e.aspect=window.innerWidth/window.innerHeight,e.updateProjectionMatrix(),t.setSize(window.innerWidth,window.innerHeight)}))}}),[]),Object(S.jsxs)(S.Fragment,{children:[Object(S.jsx)("canvas",{ref:e}),n?Object(S.jsxs)(S.Fragment,{children:[Object(S.jsx)(V,{}),Object(S.jsx)(A,{}),Object(S.jsx)(I,{})]}):null,Object(S.jsx)(P,{})]})},U=function(e){e&&e instanceof Function&&i.e(3).then(i.bind(null,32)).then((function(t){var i=t.getCLS,n=t.getFID,s=t.getFCP,r=t.getLCP,o=t.getTTFB;i(e),n(e),s(e),r(e),o(e)}))};l.a.render(Object(S.jsx)(a.a.StrictMode,{children:Object(S.jsx)(T,{})}),document.getElementById("root")),U()}},[[31,1,2]]]);
//# sourceMappingURL=main.70e43ebc.chunk.js.map